```{r}
library(tidyverse)
library(readxl)
library(cowplot)
library(openxlsx)
theme_set(theme_cowplot())
```

```{r}
# Reading in Data
dicty_total = read_excel(file.choose(), 
                         sheet = "Total_Cell_Output") %>% 
  mutate(Cell_Line = factor(Cell_Line, 
                            levels=c("AX2", "G120", "dDia2","VASP","mhcA"))) %>% 
  mutate(Plasmid = factor(Plasmid, levels = c("pDTi516", "pDTi571","pDTi557", "pDTi500"))) 

dicty_total_trim = dicty_total %>% 
  group_by(Cell_Line, Plasmid) %>%
  filter(Filo_Number > 0)

dicty_filo = read_excel(file.choose(), 
                   sheet = "Total_Filo_Output") %>% 
  mutate(Cell_Line = factor(Cell_Line, 
                            levels=c("AX2", "G120", "dDia2","VASP","mhcA"))) %>% 
    mutate(Plasmid = factor(Plasmid, levels = c("pDTi516", "pDTi571","pDTi557", "pDTi500")))

```

```{r}
# Table Summaries of Data
totalcell_details = dicty_total %>% 
  mutate(Filopodia = ifelse(Filo_Number > 0,1,0)) %>%
  group_by(Cell_Line, Plasmid) %>% 
  summarize(Total_Cells= n(),
            Filopodia_Cells = sum(Filopodia == 1),
            Filopodia_Proportion = (Filopodia_Cells / Total_Cells) * 100,
            CortBody_Ratio_Avg = mean(Cortex_Body, na.rm = T),
            CortBody_Ratio_SD = sd(Cortex_Body, na.rm = T),
            )

filopercell_details = dicty_total %>%
  group_by(Cell_Line, Plasmid) %>%
  filter(Filo_Number > 0) %>%
  summarize(FiloNum_Avg = mean(Filo_Number, na.rm = T),
            FiloNum_SD = sd(Filo_Number, na.rm = T),
            Median_FiloNum = median(Filo_Number, na.rm = T)
            )

filo_length_details = dicty_filo %>%
  group_by(Cell_Line, Plasmid) %>%
  summarize(Filo_Length_Avg = mean(Filo_Length, na.rm =  T),
            Filo_Length_SD = sd(Filo_Length, na.rm = T),
            Filo_Length_Median = median(Filo_Length, na.rm = T)
            )

mytable_actin = cbind(totalcell_details[1:7], 
                      filopercell_details[3:4], 
                      filo_length_details[3:4]) %>% 
  filter(Cell_Line %in% c("AX2", "G120", "dDia2", "VASP")) %>% 
  filter(Plasmid %in% c("pDTi516", "pDTi571", "pDTi500"))
mytable_actin

mytable_mhcA = cbind(totalcell_details[1:7], 
                     filopercell_details[3:4], 
                     filo_length_details[3:4]) %>% 
  filter(Cell_Line %in% c("AX2", "G120", "mhcA"))
mytable_mhcA
```

```{r, echo=FALSE}
# Stacked BarPlot for Cells Producing Filopodia 
(stacked_table = totalcell_details %>% 
  select(c(Cell_Line, Plasmid, Total_Cells, Filopodia_Cells)) %>% 
  ggplot() +
  geom_bar(aes(x = Cell_Line,
               y = Total_Cells,
               fill = Plasmid),
           position = 'stack',
           stat = 'identity') +
  labs(y = 'Total Cells',
       x = 'Cell Line')
)
```

```{r, echo = FALSE}
# # Rosner Outlier Test
# filonum_outliers = EnvStats::rosnerTest(dicty_total_trim$Filo_Number,
#                               k = 2)
# 
# cortexcellbody_outliers = EnvStats::rosnerTest(dicty_total$Cortex_Body,
#                                       k = 10)
# 
# filolength_outliers = EnvStats::rosnerTest(dicty_filo$Filo_Length,
#                                  k = 20)
```

```{r, echo=FALSE}
# Stats on variables
filo_num_mod = aov(Filo_Number ~ Cell_Line * Plasmid, 
      data = dicty_total_trim)
TukeyHSD(filo_num_mod, "Cell_Line:Plasmid")

cortexcellbody_mod = aov(Cortex_Body ~ Cell_Line * Plasmid, 
                         data = dicty_total_trim)
TukeyHSD(cortexcellbody_mod, "Cell_Line:Plasmid")

filo_length_mod = aov(Filo_Length ~ Cell_Line * Plasmid,
                      data = dicty_filo)
TukeyHSD(filo_length_mod, "Cell_Line:Plasmid")
```

```{r}
# GGplots of Data 
(filo_per_cell_actin = dicty_total %>%
   filter(Cell_Line %in% c("AX2", "G120", "VASP", "dDia2")) %>% 
   filter(Plasmid %in% c("pDTi516", "pDTi571", "pDTi500")) %>% 
    group_by(Cell_Line, Plasmid) %>% 
    filter(Filo_Number > 0 & Filo_Number <30) %>% 
    ggplot(aes(x = Cell_Line, y = Filo_Number, color =Plasmid)) +
    ggforce::geom_sina(scale = F) +
   geom_point(data = mytable_actin,
              aes(y = mytable_actin$FiloNum_Avg,
                  group_by = mytable_actin$Plasmid),
                  position = position_dodge(width = 0.9),
                  color = "black",
                  alpha = 0.5,
                  size = 1.5) +
   geom_errorbar(data =mytable_actin,
                 aes(y = mytable_actin$FiloNum_Avg,
                     group_by = mytable_actin$Plasmid,
                     ymin = mytable_actin$FiloNum_Avg - mytable_actin$FiloNum_SD/sqrt(mytable_actin$Total_Cells),
                     ymax = mytable_actin$FiloNum_Avg + mytable_actin$FiloNum_SD/sqrt(mytable_actin$Total_Cells)),
                 position = position_dodge(width = 0.9),
                 color = "black",
                 alpha = 0.5,
                 size = 0.75,
                 width = 0.4) +
   scale_color_manual(breaks = c("pDTi516", "pDTi571", "pDTi500"),
                         values = c("#00ba39", "#609cff", "#f8766d")) +
    labs(y = "Average Filopodia Per Cell",
         x = "Cell Line")
)

(filo_per_cell_mhcA = dicty_total %>%
   filter(Cell_Line %in% c("AX2", "G120", "mhcA")) %>% 
    group_by(Cell_Line, Plasmid) %>% 
    filter(Filo_Number > 0 & Filo_Number <30) %>% 
    ggplot(aes(x = Cell_Line, y = Filo_Number, color = Plasmid)) +
    ggforce::geom_sina(scale = F) +
   geom_point(data = mytable_mhcA,
              aes(y = mytable_mhcA$FiloNum_Avg,
                  group_by = mytable_mhcA$Plasmid),
                  position = position_dodge(width = 0.9),
                  color = "black",
                  alpha = 0.5,
                  size = 1.5) +
   geom_errorbar(data =mytable_mhcA,
                 aes(y = mytable_mhcA$FiloNum_Avg,
                     group_by = mytable_mhcA$Plasmid,
                     ymin = mytable_mhcA$FiloNum_Avg - mytable_mhcA$FiloNum_SD/sqrt(mytable_mhcA$Total_Cells),
                     ymax = mytable_mhcA$FiloNum_Avg + mytable_mhcA$FiloNum_SD/sqrt(mytable_mhcA$Total_Cells)),
                 position = position_dodge(width = 0.9),
                 color = "black",
                 alpha = 0.5,
                 size = 0.75,
                 width = 0.4) +
    scale_color_manual(breaks = c("pDTi516", "pDTi571","pDTi557", "pDTi500"),
                         values = c("#00ba39", "#609cff","#FF00FF", "#f8766d")) +
    labs(y = "Average Filopodia Per Cell",
         x = "Cell Line")
)

(cortex_actin = dicty_total %>%
   filter(Cell_Line %in% c("AX2", "G120", "VASP", "dDia2")) %>% 
    filter(Plasmid %in% c("pDTi516", "pDTi571", "pDTi500")) %>% 
    group_by(Cell_Line, Plasmid) %>% 
    ggplot(aes(x = Cell_Line,
               y = Cortex_Body,
               color = Plasmid)) +
    ggforce::geom_sina(scale = F) +
   geom_point(data = mytable_actin,
              aes(y = mytable_actin$CortBody_Ratio_Avg,
                  group_by = mytable_actin$Plasmid),
                  position = position_dodge(width = 0.9),
                  color = "black",
                  alpha = 0.5,
                  size = 1.5) +
   geom_errorbar(data = mytable_actin,
                 aes(y = mytable_actin$CortBody_Ratio_Avg,
                     group_by = mytable_actin$Plasmid,
                     ymin = mytable_actin$CortBody_Ratio_Avg - mytable_actin$CortBody_Ratio_SD/sqrt(mytable_actin$Total_Cells),
                     ymax = mytable_actin$CortBody_Ratio_Avg + mytable_actin$CortBody_Ratio_SD/sqrt(mytable_actin$Total_Cells)),
                 position = position_dodge(width = 0.9),
                 color = "black",
                 alpha = 0.5,
                 size = 0.75,
                 width = 0.4) +
    scale_color_manual(breaks = c("pDTi516", "pDTi571", "pDTi500"),
                         values = c("#00ba39", "#609cff", "#f8766d")) +
    labs(y = "Cortex:Cell Body Signal Ratio",
         x = "Cell Line")
)

(cortex_mhcA = dicty_total %>%
   filter(Cell_Line %in% c("AX2", "G120", "mhcA")) %>% 
    group_by(Cell_Line, Plasmid) %>% 
    ggplot(aes(x = Cell_Line,
               y = Cortex_Body,
               color = Plasmid)) +
    ggforce::geom_sina(scale = F) +
   geom_point(data = mytable_mhcA,
              aes(y = mytable_mhcA$CortBody_Ratio_Avg,
                  group_by = mytable_mhcA$Plasmid),
                  position = position_dodge(width = 0.9),
                  color = "black",
                  alpha = 0.5,
                  size = 1.5) +
   geom_errorbar(data = mytable_mhcA,
                 aes(y = mytable_mhcA$CortBody_Ratio_Avg,
                     group_by = mytable_mhcA$Plasmid,
                     ymin = mytable_mhcA$CortBody_Ratio_Avg - mytable_mhcA$CortBody_Ratio_SD/sqrt(mytable_mhcA$Total_Cells),
                     ymax = mytable_mhcA$CortBody_Ratio_Avg + mytable_mhcA$CortBody_Ratio_SD/sqrt(mytable_mhcA$Total_Cells)),
                 position = position_dodge(width = 0.9),
                 color = "black",
                 alpha = 0.5,
                 size = 0.75,
                 width = 0.4) +
    scale_color_manual(breaks = c("pDTi516", "pDTi571","pDTi557", "pDTi500"),
                         values = c("#00ba39", "#609cff","#FF00FF", "#f8766d")) +
    labs(y = "Cortex:Cell Body Signal Ratio",
         x = "Cell Line")
)

(filolength_actin = dicty_filo %>%
   filter(Cell_Line %in% c("AX2", "G120", "VASP", "dDia2")) %>% 
    filter(Plasmid %in% c("pDTi516", "pDTi571", "pDTi500")) %>% 
    group_by(Cell_Line, Plasmid) %>% 
    ggplot(aes(x = Cell_Line,
               y = Filo_Length,
               color = Plasmid)) +
    ggforce::geom_sina(scale = F) +
   geom_point(data = mytable_actin,
              aes(y = mytable_actin$Filo_Length_Avg,
                  group_by = mytable_actin$Plasmid),
                  position = position_dodge(width = 0.9),
                  color = "black",
                  alpha = 0.5,
                  size = 1.5) +
   geom_errorbar(data = mytable_actin,
                 aes(y = mytable_actin$Filo_Length_Avg,
                     group_by = mytable_actin$Plasmid,
                     ymin = mytable_actin$Filo_Length_Avg - mytable_actin$Filo_Length_SD/sqrt(mytable_actin$Total_Cells),
                     ymax = mytable_actin$Filo_Length_Avg + mytable_actin$Filo_Length_SD/sqrt(mytable_actin$Total_Cells)),
                 position = position_dodge(width = 0.9),
                 color = "black",
                 alpha = 0.5,
                 size = 0.75,
                 width = 0.4) +
    scale_color_manual(breaks = c("pDTi516", "pDTi571", "pDTi500"),
                         values = c("#00ba39", "#609cff", "#f8766d")) +
    labs(y = "Filopodia Length (um)",
         x = "Cell Line")
)

(filolength_mhcA = dicty_filo %>%
   filter(Cell_Line %in% c("AX2", "G120", "mhcA")) %>% 
    group_by(Cell_Line, Plasmid) %>% 
    ggplot(aes(x = Cell_Line,
               y = Filo_Length,
               color = Plasmid)) +
    ggforce::geom_sina(scale = F) +
   geom_point(data = mytable_mhcA,
              aes(y = mytable_mhcA$Filo_Length_Avg,
                  group_by = mytable_mhcA$Plasmid),
                  position = position_dodge(width = 0.9),
                  color = "black",
                  alpha = 0.5,
                  size = 1.5) +
   geom_errorbar(data = mytable_mhcA,
                 aes(y = mytable_mhcA$Filo_Length_Avg,
                     group_by = mytable_mhcA$Plasmid,
                     ymin = mytable_mhcA$Filo_Length_Avg - mytable_mhcA$Filo_Length_SD/sqrt(mytable_mhcA$Total_Cells),
                     ymax = mytable_mhcA$Filo_Length_Avg + mytable_mhcA$Filo_Length_SD/sqrt(mytable_mhcA$Total_Cells)),
                 position = position_dodge(width = 0.9),
                 color = "black",
                 alpha = 0.5,
                 size = 0.75,
                 width = 0.4) +
    scale_color_manual(breaks = c("pDTi516", "pDTi571","pDTi557", "pDTi500"),
                         values = c("#00ba39", "#609cff","#FF00FF", "#f8766d")) +
    labs(y = "Filopodia Length (um)",
         x = "Cell Line ")
)
```



```{r}
(filo_per_cell_actin = dicty_total %>%
   filter(Cell_Line %in% c("AX2", "G120", "VASP", "dDia2")) %>% 
    group_by(Cell_Line, Plasmid) %>% 
    filter(Filo_Number > 0 & Filo_Number <30) %>% 
    ggplot(aes(x = Cell_Line, y = Filo_Number, color =Plasmid)) +
    ggforce::geom_sina(scale = F) +
   geom_point(data = mytable_actin,
              aes(y = mytable_actin$FiloNum_Avg,
                  group_by = mytable_actin$Plasmid),
                  position = position_dodge(width = 0.9),
                  color = "black",
                  alpha = 0.5,
                  size = 1.5) +
   geom_errorbar(data =mytable_actin,
                 aes(y = mytable_actin$FiloNum_Avg,
                     group_by = mytable_actin$Plasmid,
                     ymin = mytable_actin$FiloNum_Avg - mytable_actin$FiloNum_SD/sqrt(mytable_actin$Total_Cells),
                     ymax = mytable_actin$FiloNum_Avg + mytable_actin$FiloNum_SD/sqrt(mytable_actin$Total_Cells)),
                 position = position_dodge(width = 0.9),
                 color = "black",
                 alpha = 0.5,
                 size = 0.75,
                 width = 0.4) +
   scale_color_manual(breaks = c("pDTi516", "pDTi571", "pDTi500"),
                         values = c("#00ba39", "#609cff", "#f8766d")) +
    labs(y = "Average Filopodia Per Cell",
         x = "Cell Line")
)
```


